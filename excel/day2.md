# Excel DX：ファイル処理を自動化して業務を変える - AWS Lambda で作る実践的 Excel 統合システム

> **Excel DX**（デジタルトランスフォーメーション）とは、
> *人手でExcelを作る業務* を、
> *システムが裏側でデータを整え、必要なときだけExcelを開く業務* に変えることです。
>
> 本記事では、AWS Lambda を中心に
> **複数のファイルを解析 → データベースに正規化 → Excel に自動出力する処理系**
> を、実務目線で解説します。

---

## はじめに：なぜ Excel DX が必要なのか

多くの現場では、次のような作業が日常的に発生しています。

* 部署ごとに提出される CSV / Excel を集める
* 列をそろえてコピー＆ペースト
* 集計式を直してグラフを更新
* 「あれ、数が合わない…」と見直す

これらはすべて **人がExcelを作る前提** の業務です。

Excel DX では考え方を変えます。

> **Excelは「作るもの」ではなく「出力される成果物」**

この発想に切り替えると、業務設計が一気にシンプルになります。

---

## 具体例：Excel DX の現場での活用

### ① 退勤表を自動集計する

（S3 → Lambda → DynamoDB/RDS → Excel）

**ユースケース**
各部署から提出される「退勤表.xlsx」「打刻履歴.csv」をアップロードするだけで、
全社集計済みの退勤表 Excel が自動生成される。

#### 処理の流れ

1. 各部署が退勤表を S3 にアップロード

   ```
   inbound/attendance/2025-10/部署A/退勤表.csv
   ```
2. S3 Put イベントで Lambda が起動
3. Lambda が以下を実施

   * 列名の揺れを吸収（社員番号 / emp_id など）
   * 日付・時刻を正規化
   * 勤務時間・残業時間を計算
4. 従業員ID＋日付単位で DB に upsert（冪等）
5. 月次集計 Lambda が Excel を生成

   * 部署別
   * 社員別
   * 残業上位者をハイライト

👉 **人がやるのは「ファイルを置く」だけ**
👉 集計・計算・Excel作成はすべて自動

---

### ② インターネットバンキングの取引履歴を統合

（S3 → Step Functions → Lambda → DB → Excel）

**ユースケース**
複数銀行・複数口座の取引CSVをまとめて、
月次の「入出金台帳 Excel」を自動生成する。

---

## データモデルの例（DynamoDB）

銀行取引は「口座 × 日付 × 複数取引」という構造です。
これを DynamoDB で扱いやすくするため、**文字列で階層構造を表現**します。

### テーブル設計

| 項目       | 例                       | 説明    |
| -------- | ----------------------- | ----- |
| PK       | `ACCT#0012345678`       | 口座ID  |
| SK       | `DATE#20251105#TS#0001` | 日付＋連番 |
| desc     | 給与振込                    | 摘要    |
| debit    | 50000                   | 出金    |
| credit   | 300000                  | 入金    |
| balance  | 1450000                 | 残高    |
| row_hash | sha256(...)             | 重複防止  |
| source_* | S3情報                    | 取込元   |

### GSI（検索用）

* **GSI1PK**：`ACCT#{account_id}`
* **GSI1SK**：`DATE#{yyyymmdd}`

👉

* 口座単位で日付順に取得
* 日別収支・月次集計が高速

---

## Excel出力の設計（完成形イメージ）

### シート構成

| シート                | 内容            |
| ------------------ | ------------- |
| **Transactions**   | 全取引明細（フィルタ付き） |
| **DailyNet**       | 日別の入出金差引      |
| **MonthlySummary** | 月次集計・平均       |

### 書式

* 金額はカンマ区切り
* 出金（負数）は赤表示
* ヘッダ固定・オートフィルタ
* 残高列は強調表示

### グラフ

* **DailyNet**：折れ線（資金推移）
* **カテゴリ別**：円グラフ（支出割合）

👉 ダウンロード後すぐ会議資料として使えるExcel

---

## セキュリティとガバナンス

金融・勤怠データでは **安全に扱える設計** が必須です。

### アップロード権限の分離

* 担当者ごとに S3 プレフィックス制限

  ```
  inbound/banking/mufg/ → MUFG担当者のみ
  inbound/banking/ja/   → JA担当者のみ
  ```
* S3バケットポリシー＋IAMで制御

👉 誤操作・誤上書きを防止

### 正規データのみ取り込み

* 銀行サイトのスクレイピングは禁止
* **公式ダウンロードCSVのみ** を処理対象に

👉 規約・法令リスクを回避

### 署名付きURLの管理

* Excel共有は presigned URL
* 有効期限は **1〜24時間**

👉 漏えいリスク最小化

---

## 障害時のハンドリング

### 異常データの隔離（Quarantine）

* 列欠損・金額異常などは

  ```
  quarantine/banking/{run_id}.csv
  ```

  に退避
* 修正後に再アップロードするだけで再処理可能

### 重複登録の防止

* 各行に `row_hash` を付与
* 同一取引は自動スキップ

👉 リトライ・再実行しても安全

---

## どっちを選ぶ？Lambda vs 他基盤 早見表

| 観点      | Lambda | ECS / Batch |
| ------- | ------ | ----------- |
| データ量    | 中小規模   | 大規模         |
| 処理時間    | ≤15分   | 長時間         |
| 導入コスト   | 低      | 中           |
| Excel帳票 | ◎      | ◎           |
| 重い処理    | △      | ◎           |

---

## おすすめの始め方（5ステップ）

1. S3にファイルを集める
2. Lambdaで1ファイル解析
3. DBに正規化保存
4. Excelテンプレで出力
5. 定期実行＋監視

---

## 導入後に得られる効果

### 定量的

* 月次集計：1〜2人日 → 数分
* ヒューマンエラー激減

### 定性的

* 属人化の解消
* 分析・判断に時間を使える
* データ活用文化が育つ

---

## まとめ：Excel DX は「脱・手作業」から「知の自動化」へ

Excelは、現場で最も使われる **情報の出口** です。
だからこそ、その裏側を自動化する価値があります。

> **人がExcelを作る時代から、
> Excelが人の仕事を支える時代へ。**

今日から始められる Excel DX。
まずは *1つの帳票* から、始めてみてください。
